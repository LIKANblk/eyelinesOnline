---
title: "Experiment Report"
author: "BCI Lab"
output: pdf_document
params:
  path: character
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(eyelinesOnline)
load(params$path)
```

## Experiment path
```{r, echo=FALSE}
my_path <- paste0(str_filter(experiment[[1]]$file_data$filename_edf, '(^.+/[[:digit:]]+)/[[:digit:]]+.edf')[[1]][2], '/')
cat(my_path)
```

## Dates
```{r, echo=FALSE}
experiment_date <- paste0('Experiment date: ', experiment[[1]]$file_data$date)
report_date <- paste0('Report date: ', format(Sys.Date(), format="%d.%m.%Y"))
cat(paste0(experiment_date, '\n', report_date))
```

## Classifier parameters
```{r, echo=FALSE}
res <- buildClassifier(my_path)
##eval(parse(text = paste0(readLines(filename, warn = F), collapse = '\n')))

cat(sprintf('Target epochs:    %i
Nontarget epochs: %i

Specifity:
   Train: %.3f ± %.3f
   Test:  %.3f ± %.3f
Sensivity:
   Train: %.3f ± %.3f
   Test:  %.3f ± %.3f
Accuracy:
   Train: %.3f ± %.3f
   Test:  %.3f ± %.3f
AUC:
   Train: %.3f ± %.3f
   Test:  %.3f ± %.3f
   All:   %.3f ± %.3f

',
res$target_epochs, res$nontarget_epochs,
res$quality$spec$tr[1],  res$quality$spec$tr[2],
res$quality$spec$tst[1], res$quality$spec$tst[2],

res$quality$sens$tr[1],  res$quality$sens$tr[2],
res$quality$sens$tst[1], res$quality$sens$tst[2],

res$quality$acc$tr[1],  res$quality$acc$tr[2],
res$quality$acc$tst[1], res$quality$acc$tst[2],

res$quality$auc$tr[1],  res$quality$auc$tr[2],
res$quality$auc$tst[1], res$quality$auc$tst[2],
res$quality$auc$all[1], res$quality$auc$all[2]))

```

\pagebreak

## Dwells

```{r fig.height=8, fig.width=12}
dwell_histogram(experiment)
```

\pagebreak

## EEG Epochs

### True positive epochs

```{r fig.height=8, fig.width=12}
draw_eeg_epochs(experiment, 'true_positive')
```

\pagebreak

### True negative epochs

```{r fig.height=8, fig.width=12}
draw_eeg_epochs(experiment, 'true_negative')
```

\pagebreak

### False negative epochs

```{r fig.height=8, fig.width=12}
draw_eeg_epochs(experiment, 'false_negative')
```

\pagebreak

## Eye speed epochs

```{r fig.height=9, fig.width=12}
draw_eye_epochs(experiment)
```

```{r include=FALSE}
remove(experiment)
remove(res)
remove(my_path)
remove(experiment_date)
remove(report_date)
```